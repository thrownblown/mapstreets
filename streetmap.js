function init(){map=L.map("map",{scrollWheelZoom:false}).setView(center,14);mapLink='<a href="http://opencyclemap.org">OpenStreetMap</a>';L.tileLayer("http://{s}.tile.opencyclemap.org/cycle/{z}/{x}/{y}.png",{attribution:"&copy; "+mapLink+" Contributors",minZoom:12}).addTo(map);var e=MQ.mapLayer();var t=new L.StamenTileLayer("toner");var n=new L.StamenTileLayer("terrain");L.control.layers({Toner:t,Terrain:n,Map:e,Hybrid:MQ.hybridLayer()}).addTo(map);var r=MQ.geocode().on("success",function(e){$("#logo strong").remove();var t=r.describeLocation(e.result.best);$("#logo").prepend('<strong class="grid">'+t+"</strong>")});map.on("click",function(e){r.reverse(e.latlng)});var i=new L.FeatureGroup;map.addLayer(i);var s=new L.Control.Draw({position:"topleft",draw:{polygon:{shapeOptions:{color:"red",dashArray:"10, 10"},allowIntersection:false,drawError:{color:"orange",timeout:1e3},showArea:true,metric:false,repeatMode:false},polyline:false,rectangle:false,circle:false},edit:{featureGroup:i}});map.addControl(s);$(".leaflet-draw-section:first").append('<div class="leaflet-draw-inner-toolbar" title="Polygon already drawn"></div>');map.on("draw:created",function(e){var t=e.layerType;var n=e.layer;i.addLayer(n);geoJsonPoly=n.toGeoJSON();testBox(geoJsonPoly.geometry.coordinates[0]);$(".leaflet-draw-inner-toolbar").show();$(".grid").remove();$("#streets").prepend('<br class="grid"/><button class="grid" onclick="twoFer()">Show Streets</button><br class="grid"/>')});map.on("draw:edited",function(e){var t=e.layers;t.eachLayer(function(e){if(e instanceof L.Polygon){geoJsonPoly=e.toGeoJSON();testBox(geoJsonPoly.geometry.coordinates[0])}})});map.on("draw:deleted",function(e){$(".leaflet-draw-inner-toolbar").hide();geoJsonPoly={}})}function testBox(e){testLat=[];testLng=[];for(var t=0;t<e.length;t++){testLat.push(e[t][1]);testLng.push(e[t][0])}}function applyGrid(){var e=[];var t=Array.min(testLat);while(t<Array.max(testLat)){e.push(t);t+=5e-4}var n=[];var r=Array.min(testLng);while(r<Array.max(testLng)){n.push(r);r+=5e-4}var i=e.length;var s=n.length;for(var o=0;o<i;o++){for(var u=0;u<s;u++){var a=L.latLng(e[o],n[u]);var f=L.geoJson(geoJsonPoly);var l=leafletPip.pointInLayer(a,f);if(l[0]){gridCoord.push(e[o].toString()+","+n[u].toString())}}}}function reverseGeo(){var e=gridCoord.length;for(var t=0;t<e;t++){var n=gridCoord[t];$.ajax({url:"http://www.mapquestapi.com/geocoding/v1/reverse?key=Fmjtd%7Cluub2g6bl1%2Cra%3Do5-9ual56",dataType:"jsonp",type:"POST",contentType:"json",data:{location:n},success:function(t){streets.push(t.results[0].locations[0].street);if(streets.length%20===0){streetSplit(streets)}if(streets.length===e){streetSplit(streets);$("#streets table").prepend("<tr><td><h2>COMPLETE</h2></td></tr>")}}})}}function streetSplit(e){mem={};$("#streets tr").remove();for(var t=0;t<e.length;t++){var n=e[t].split(" ");var r=parseFloat(n.slice(0,1));if(n.length>2){streetName=n.slice(1).join(" ")}else if(n.length===2){if(n[1]==="Broadway"){streetName="Broadway"}else{streetName=e[t]}}if(r){if(streetName in mem){mem[streetName].push(r)}else{mem[streetName]=[];mem[streetName].push(r)}}}var i=[];for(t in mem){i.push(t);i.sort();var s=Array.min(mem[t]);var o=Array.max(mem[t]);mem[t]=[s,o]}var u=i.length;for(t=0;t<u;t++){console.log(mem);$("#streets table").append("<tr><td width=130>"+i[t]+"</td><td><b> Min: </b>"+mem[i[t]][0]+"</td><td><b> Max: </b>"+mem[i[t]][1]+"</td></tr>")}}function twoFer(){var e=[];applyGrid();reverseGeo();$(".grid").remove()}function recenter(){var e=document.getElementById("city").value||"Dolores Park, San Francisco";var t=document.getElementById("state").value||"CA";var n=document.getElementById("zip").value||94110;$.ajax({url:"http://www.mapquestapi.com/geocoding/v1/address?&key=Fmjtd%7Cluub2g6bl1%2Cra%3Do5-9ual56&location="+e+","+t+" "+n,dataType:"jsonp",type:"POST",contentType:"json",success:function(e){center=e.results[0].locations[0].latLng;map.setView(center,14)}})}var map,geoJsonPoly,gridCoord=[],streets=[],testLat=[],testLng=[],mem={},streetName,center=[37.76700618798191,-122.427066746521];Array.max=function(e){return Math.max.apply(Math,e)};Array.min=function(e){return Math.min.apply(Math,e)};$("document").ready(init())